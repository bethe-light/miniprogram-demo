import endecoder from './endecoder';
import request from 'flyio/dist/npm/wx'

let wxApi = new request()

export default function (token, host = '//vod.bytedanceapi.com') {
    if (host && token) {
        let decodedToken = JSON.parse(endecoder.base64decode(token))
        if(decodedToken.Version === 'v1') {
          let url = `http:${host}?${decodedToken.GetPlayInfoToken}`
          return wxApi.get(url).then(function (res) {
              if(res.data && res.data.Result) {
                return res.data.Result
              } else {
                return res.data || res
              }
          });
        } else {
          return Promise.reject('token version error');
        }
    } else {
        return Promise.reject('vid, host and token can\'t be empty');
    }
}
